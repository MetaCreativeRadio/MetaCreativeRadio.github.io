#!/bin/bash

# ãƒªã‚µãƒ¼ãƒè«–æ§‹æ–‡ä½œæˆç”¨ã®ç´ æãƒãƒ³ãƒ‰ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
# Usage: npm run prepare-research <research_name>

TOPIC_NAME=$1

if [ -z "$TOPIC_NAME" ]; then
  echo "ã‚¨ãƒ©ãƒ¼: ãƒˆãƒ”ãƒƒã‚¯åã‚’æŒ‡å®šã—ã¦ãã ã•ã„"
  echo "ä½¿ç”¨ä¾‹: npm run prepare-research \"Uç†è«–\""
  exit 1
fi

# ãƒ‘ã‚¹è¨­å®š
PROJECT_ROOT="/Users/tamkai/product/MetaCreativeRadioWeb"
OPI_PROFILE="$PROJECT_ROOT/speakers/opi.md"
TAMKAI_PROFILE="$PROJECT_ROOT/speakers/tamkai.md"
RESEARCH_PROMPT="$PROJECT_ROOT/prompts/ãƒªã‚µãƒ¼ãƒè«–æ§‹æ–‡ä½œæˆæŒ‡ç¤º.txt"
OUTPUT_FILE="$PROJECT_ROOT/essay-input/research-${TOPIC_NAME}-bundle.md"

# ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
mkdir -p "$PROJECT_ROOT/essay-input"

# ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèª
if [ ! -f "$RESEARCH_PROMPT" ]; then
  echo "ã‚¨ãƒ©ãƒ¼: ãƒªã‚µãƒ¼ãƒè«–æ§‹æ–‡ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: $RESEARCH_PROMPT"
  exit 1
fi

PROMPT_CONTENT=$(cat "$RESEARCH_PROMPT")

# ãƒãƒ³ãƒ‰ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ
echo "ğŸ“ ã€Œ${TOPIC_NAME}ã€ã®ãƒªã‚µãƒ¼ãƒè«–æ§‹æ–‡ä½œæˆç”¨ç´ æã‚’æº–å‚™ä¸­..."
echo ""

cat > "$OUTPUT_FILE" << EOF
# ã€Œ${TOPIC_NAME}ã€è«–æ§‹æ–‡ä½œæˆç”¨ç´ æãƒãƒ³ãƒ‰ãƒ«ï¼ˆãƒªã‚µãƒ¼ãƒç‰ˆï¼‰

ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ã€ã€Œ${TOPIC_NAME}ã€ã®ãƒªã‚µãƒ¼ãƒè«–æ§‹æ–‡ã‚’ä½œæˆã™ã‚‹ãŸã‚ã«å¿…è¦ãªæƒ…å ±ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

---

## ğŸ“‹ æŒ‡ç¤ºãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ

ä»¥ä¸‹ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«å¾“ã£ã¦ã€å¯¾è©±ç¯‡å½¢å¼ã®è«–æ§‹æ–‡ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

\`\`\`
${PROMPT_CONTENT}
\`\`\`

---


## ğŸ‘¥ è©±è€…æƒ…å ±

### Opiï¼ˆãŠã´ãŸã‚“ãƒ»å¤§å±‹å‹ç´€é›„ï¼‰- ç†è«–å®¶ãƒ»ãƒŠãƒ“ã‚²ãƒ¼ã‚¿ãƒ¼å½¹

\`\`\`markdown
$(cat "$OPI_PROFILE")
\`\`\`

### ã‚¿ãƒ ã‚«ã‚¤ï¼ˆã‚¿ãƒ ãƒ©ã‚«ã‚¤ï¼‰- å®Ÿè·µå®¶ãƒ»æ¢æ±‚è€…å½¹

\`\`\`markdown
$(cat "$TAMKAI_PROFILE")
\`\`\`

---

## ğŸ“š ãƒªã‚µãƒ¼ãƒè³‡æ–™ã®æ·»ä»˜ã«ã¤ã„ã¦

**é‡è¦**: ã“ã®ãƒãƒ³ãƒ‰ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’Webç‰ˆClaudeã«å…¥åŠ›ã™ã‚‹éš›ã€**ã€Œ${TOPIC_NAME}ã€ã«é–¢ã™ã‚‹ãƒªã‚µãƒ¼ãƒè³‡æ–™ã‚’åˆ¥é€”æ·»ä»˜ã—ã¦ãã ã•ã„**ã€‚

### æ·»ä»˜å¯èƒ½ãªå½¢å¼
- PDFãƒ•ã‚¡ã‚¤ãƒ«
- Markdownãƒ•ã‚¡ã‚¤ãƒ«
- ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
- Wordãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- ãã®ä»–ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå½¢å¼

### æ·»ä»˜æ–¹æ³•
1. ã“ã®ãƒãƒ³ãƒ‰ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’Webç‰ˆClaudeã«ã‚³ãƒ”ãƒš
2. ğŸ“ï¼ˆã‚¯ãƒªãƒƒãƒ—ã‚¢ã‚¤ã‚³ãƒ³ï¼‰ã‹ã‚‰ã€Œ${TOPIC_NAME}ã€ã®ãƒªã‚µãƒ¼ãƒè³‡æ–™ã‚’æ·»ä»˜
3. ClaudeãŒè‡ªå‹•çš„ã«å¯¾è©±ç¯‡å½¢å¼ã®è«–æ§‹æ–‡ã‚’ç”Ÿæˆ

---

## âœ… ç¢ºèªäº‹é …

- **è©±è€…**: Opiï¼ˆç†è«–å®¶å½¹ï¼‰ã¨ã‚¿ãƒ ã‚«ã‚¤ï¼ˆå®Ÿè·µå®¶å½¹ï¼‰
- **ã‚¿ãƒ¼ã‚²ãƒƒãƒˆèª­è€…**: ãƒ“ã‚¸ãƒã‚¹ãƒ‘ãƒ¼ã‚½ãƒ³
- **å‡ºåŠ›å½¢å¼**: Markdownå½¢å¼ã®å¯¾è©±ç¯‡è«–è€ƒ
- **å¯¾è©±ã®æ€§è³ª**: å®Œå…¨å‰µä½œå¯ï¼ˆãƒªã‚µãƒ¼ãƒè³‡æ–™ã¨è©±è€…ç‰¹æ€§ã«åŸºã¥ãé™ã‚Šï¼‰

**é‡è¦**:
- Opiã¯æ·»ä»˜ã•ã‚ŒãŸãƒªã‚µãƒ¼ãƒè³‡æ–™ã®å†…å®¹ã‚’ç†è«–å®¶ã¨ã—ã¦ç´¹ä»‹
- ã‚¿ãƒ ã‚«ã‚¤ã¯è‡ªèº«ã®å®Ÿè·µçµŒé¨“ï¼ˆã‚°ãƒ©ãƒ¬ã‚³ã€Purpose Carvingç­‰ï¼‰ã‹ã‚‰ç†è«–ã‚’ç†è§£
- è‡ªç„¶ãªå¯¾è©±ã®æµã‚Œã§ã€ç†è«–ã¨å®Ÿè·µã‚’æ¶æ©‹ã™ã‚‹

ã“ã®ç´ æã¨æ·»ä»˜ã•ã‚ŒãŸãƒªã‚µãƒ¼ãƒè³‡æ–™ã‚’ã‚‚ã¨ã«ã€å¯¾è©±ç¯‡å½¢å¼ã®è«–æ§‹æ–‡ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚
EOF

echo "âœ… ç´ æãƒãƒ³ãƒ‰ãƒ«ä½œæˆå®Œäº†: $OUTPUT_FILE"
echo ""
echo "ğŸ“Œ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:"
echo "1. $OUTPUT_FILE ã‚’Webç‰ˆClaudeï¼ˆSonnet 4.5ï¼‰ã«ã‚³ãƒ”ãƒš"
echo "2. ç”Ÿæˆã•ã‚ŒãŸè«–æ§‹æ–‡ã‚’ã‚³ãƒ”ãƒ¼"
echo "3. npm run save-research \"$RESEARCH_NAME\" ã‚’å®Ÿè¡Œã—ã¦ä¿å­˜"
echo ""
